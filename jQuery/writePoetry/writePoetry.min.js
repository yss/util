(function($,undefined){function WritePoetry(elem,options){if(!(this instanceof WritePoetry))return new WritePoetry(elem,options);elem=$(elem);if(!elem.length)return;var defaultOptions={isLoop:true,scopeValue:64,pos:0,duration:2e3,delay:2e3,easing:"swing"};$.extend(defaultOptions,options);defaultOptions._width=parseInt(elem.outerWidth()/2,10);defaultOptions._height=parseInt(elem.outerHeight()/2,10);defaultOptions.elems=elem.children();if(defaultOptions.ignoreClass){defaultOptions.elems=defaultOptions.elems.not(defaultOptions.ignoreClass)}elem.css("position","relative");this.config=defaultOptions;this.elem=elem;this.init()}$.extend(WritePoetry.prototype,{_getDiff:function(val){return Math.round((val+val)*Math.random())-val},_randomPos:function(size){var config=this.config,width=config._width,height=config._height,scopeValue=config.scopeValue,diffWidth=this._getDiff(scopeValue+width),diffHeight=this._getDiff(scopeValue+height);if(diffWidth<0){diffWidth-=size.width}else{diffHeight-=size.height}return{left:diffWidth+width,top:diffHeight+height}},run:function(){var _this=this,config=this.config,elems=config.elems;if(elems.length==config.pos){if(config.isLoop){config.pos=0}else{return}}elems.eq(config.pos).animate(config._centerPos[config.pos],config.duration,config.easing,function(){var t=$(this);window.setTimeout(function(){t.animate($.extend(_this._randomPos(config._size[config.pos]),{opacity:0}),config.duration,config.easing);config.pos++;_this.run()},config.delay)})},appendData:function(elems){elems=$(elems);if(elems.length){elems.appendTo(this.elem);this.config.elems=this.config.elems.add(elems);this.initData(elems)}},initData:function(elems){elems=elems||this.config.elems;elems.css({position:"absolute",opacity:0}).show();this._position(elems)},_position:function(elems){var _this=this,config=_this.config;elems.each(function(){var elem=$(this),width=elem.width(),height=elem.height(),o={width:width,height:height};elem.css(_this._randomPos(o));config._size.push({width:width,height:height});config._centerPos.push({left:config._width-width/2,top:config._height-height/2,opacity:1})})},init:function(){var _this=this,config=this.config;config._size=[],config._centerPos=[];this.initData();this.run()}});$.writePoetry=WritePoetry})(jQuery);